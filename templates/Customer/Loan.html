{% extends 'Customer/layout/base.html' %}
{% block content %}
<div class="right_col" role="main">
    <div class="">
        <div class="row top_tiles">
            <div class="animated flipInY col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="tile-stats" style="background-color: #003b4e; color: #0b2e13;">
                    <a class="site_title" style="background-color: #51a9b5;"> Loan</a>
                </div>
            </div>
        </div>

        <div class="rd-details">
            <a href="create_loan" class="btn btn-primary">Apply for Loan</a>
            <h1>Personal Loans</h1>
            <div class="rd-accounts-container">
                {% for loan in personal_loans %}
                    <div class="rd-account-card">
                        <h4>Loan Account Details</h4>
                        <div class="account-info">
                            <p><strong>Loan Amount:</strong> {{ loan.amount }}</p>
                            <p><strong>Interest Rate: </strong> {{ loan.interest_rate }}</p>
                            <p><strong>Tenure:</strong> {{ loan.tenure }} months</p>
                            <p><strong>Status:</strong> {{ loan.status }}</p>
                            <p><strong>Created Date:</strong> {{ loan.created_date }}</p>
                             <p><strong>Next EMI Amount:</strong> {{ loan.total_payment.total_payment }}</p>  
                            <!-- <p><strong>Next EMI Date:</strong> {{ item.next_payment_date }}</p> -->
                        </div>
                        <div class="emi-payment">
                            <a href="{% url 'loan_emipay' loan.id %}" class="btn btn-primary" onclick="return confirm('Would you like to  pay the Loan EMI');">Pay EMI</a>
                        </div>


                        

                        <h2>EMI Table</h2>
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Month</th>
                                    <th>Principal</th>
                                    <th>Interest</th>
                                    <th>Total Payment</th>
                                    <th>Balance</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% if loan.schedule %}
                                    {% for entry in loan.schedule %}
                                        <tr>
                                            <td>Month {{ entry.month }}</td>
                                            <td>₹ {{ entry.principal }}</td>
                                            <td>₹ {{ entry.interest }}</td>
                                            <td>₹ {{ entry.total_payment }}</td>
                                            <td>₹ {{ entry.balance }}</td>
                                            <td>{{ entry.status }}</td>
                                        </tr>
                                    {% endfor %}
                                {% else %}
                                    <tr>
                                        <td colspan="5">No schedule available</td>
                                    </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                {% endfor %} <!-- Missing endfor tag was added here -->
            </div>
        </div>

        <style>
            /* Styles remain unchanged */
            .rd-details {
                    padding: 20px;
                    background-color: #f4f6f8;
                    border-radius: 10px;
                    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
                    max-width: 1200px;
                    margin: auto;
                }

                .rd-details h1 {
                    color: #004d40;
                    margin-bottom: 20px;
                }

                .rd-accounts-container {
                    display: flex;
                    flex-wrap: wrap;
                    gap: 20px;
                }

                .rd-account-card {
                    background-color: #ffffff;
                    border: 1px solid #dbe2e8;
                    border-radius: 10px;
                    padding: 20px;
                    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
                    width: 100%;
                    max-width: 1000px;
                    box-sizing: border-box;
                }

                .rd-account-card h4 {
                    margin-top: 0;
                    color: #004d40;
                    font-size: 18px;
                    border-bottom: 2px solid #004d40;
                    padding-bottom: 5px;
                    margin-bottom: 15px;
                }

                .account-info p {
                    margin: 10px 0;
                    color: #333;
                }

                .account-info strong {
                    color: #004d40;
                }

                .table {
                    width: 100%;
                    margin-bottom: 20px;
                    border-collapse: collapse;
                }

                .table th,
                .table td {
                    padding: 12px;
                    text-align: left;
                    border-bottom: 1px solid #ddd;
                }

                .table th {
                    background-color: #004d40;
                    color: white;
                }

                .table-striped tbody tr:nth-of-type(odd) {
                    background-color: #f9f9f9;
                }
        </style>
    </div>
</div>
{% endblock %}
